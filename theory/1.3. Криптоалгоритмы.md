### 1.3. Криптоалгоритмы

Итак, криптоалгоритмы или криптографические системы — это целостная структура или модель, которая совершает 
двусторонние криптопреобразования над какими-либо данными или информацией, а также имеет специальную систему, 
которая преобразовывает ключи и пароли.
Наиболее популярным является деление криптографических систем на симметричные (с закрытым ключом) и асимметричные 
(с открытым ключом). Симметричная шифрсистема – система шифрования, в которой ключи зашифрования и расшифрования 
совпадают, либо легко определяются один по другому. Асимметричная шифрсистема – система шифрования, в которой 
используются открытые ключи, применяемые в процессе зашифровывания, и секретные ключи, используемые в процессе 
расшифровывания сообщения.
При сравнении этих систем очевидно, что симметричная шифрсистема имеет более высокую скорость шифрования, меньший 
размер ключа и более высокую криптостойкость, а асимметричная система использует более удобные протоколы и не имеет 
защищенный канал связи для передачи секретного ключа (он просто-напросто не требуется).
Криптографические средства и системы можно классифицировать по другим признакам:
    • по доступности информации (ограниченного использования, общего использования);
    • по количеству ключей (бесключевые, одноключевые, двухключевые, многоключевые);
    • по стойкости криптоалгоритма (безусловно стойкие, доказуемо стойкие, предположительно стойкие);
    • по используемым средствам шифрования (программные, аппаратные, программно-аппаратные);
    • по наличию сертификата (сертифицированные, несертифицированные).
    • по размеру блока информации (потоковые, блочные).
Рассмотрим основные известные криптоалгоритмы, стойкость которых мы будем проверять.
   
   #### 1.3.1. Одноалфавитные шифры подстановки. Шифр Цезаря
   
Криптографическая система, стойкость которой основана на секретности способов шифрования и дешифрования, является 
криптосистемой ограниченного использования. Самый хороший пример такой системы – шифр Цезаря, где каждый символ 
открытого текста заменяется на символ, стоящий в алфавите правее или левее него на фиксированное число позиций. Такое 
преобразование кодированного сообщения назвали ROTN, где N — сдвиг, ROT — «циклический сдвиг», то есть ROTATE на 
английском языке. Какая будет длина алфавита – столько подстановок можно сделать. Например, для русского языка всего 
возможно 32 разных преобразования (от ROT0 до ROT33), потому что, если брать N больше, то получаются уже повторения. 
Гай Юлий Цезарь, в честь которого назвали этот метод, использовал его для тайной переписки с генералами.
Чуть более интересным является афинный шифр, где каждой букве алфавита n ставится в соответствие число из диапазона 0 
… n-1.

   #### 1.3.2. Бесключевые криптосистемы. Blum-Blum-Shub
   
Если же стойкость криптографической системы основана на секретности ключа, элемента шифрсистемы, который обеспечивает 
надежность шифра, то у такой системы будет открытый, то есть общий доступ.
Бесключевые криптосистемы не используют в процессе криптографических преобразований данных какого-либо ключа. К таким 
необычным криптосистемам относятся хеш-функции и ГПСЧ (генераторы псевдослучайных чисел). Под хеш-функцией 
подразумевается математическая функция, которые принимает на входе строку данных переменной длины и преобразует ее в 
строку фиксированной длины. Стоит отметить, что наша хеш-функция, кроме способности легко вычисляться, должна создавать 
минимальное число коллизий, когда по разным ключам выводится одно значение.
Рассмотрим работу хеш-функции на простейших примерах – методе деления, аддитивном методе и методе «середины квадрата».
Метод деления
Первоначально нам будут известны ключ key, являющийся целой переменной, а также размер хеш-таблицы m– это наши исходные 
данные. Созданная хеш-функция будет делить значение нашего ключа на размер таблицы и выводить остаток от деления.

int h(int key, int m) {
return key % m; // значение хеш-функции
}

**Аддитивный метод**
В данном методе первоначальные данные – это ключ, являющийся символьной строкой и размер таблицы. Далее создается сама 
хеш-функция, в которой строка преобразуется в целое число с помощью суммирования всех символов, а потом в качестве 
результата возвращается остаток от деления на m.

int h(char *key, int m) {
int s = 0;
while(*key)
s += *key++;
return s % m;
}

**Метод середины квадрата**
В качестве исходных данных дается один ключ, который в хеш-функции возводится в квадрат (во вторую степень). В качестве 
результата работы хеш-функции мы получаем несколько средних чисел вычисленного значения.
Пример для ключа размером в 32 бита и результатом хеш-функции, являющимся, средними 10 битами квадрата значения ключа:

int h(int key) {
key *= key;
key >>= 11; // Отбрасываем 11 младших бит
return key % 1024; // Возвращаем 10 младших бит
}

ГПСЧ является некой функцией, которая вычисляется за полиномиальное время n. Этот генератор производит ключ, 
представляющий из себя случайный двоичный набор.
Рассмотрим самый криптостойкий и надежный ГПСЧ, называемый Blum-Blum-Shub (BBS), который генерирует последовательность 
из случайных бит.
Алгоритм метода шифрования BBS состоит из следующих задач:
    • генерация двух больших простых чисел p и q, отвечающих следующему критерию: p=q=3 mod 4;
    • вычисляется число M = p*q;
    • берется какое-то большое число x0, взаимно простое с M;
    • создается цикл с генерацией чисел, которые вычисляются по специальной формуле: xi+1 =xi2 mod M => 
    получается некая последовательность чисел;
    • в качестве результата выводится последний бит числа xi.
На сегодняшний день BBS алгоритм является почти самым надежным ГПСЧ, потому что, чтобы взломать данный шифр, взломщик 
должен знать два числа - p и q. Однако, и у этого метода есть свой недостаток, и это, конечно же, его низкая скорость 
работы.
   
   #### 1.3.3. Симметричные шифры. AES (Rijndael)
   
Одноключевые (симметричные) криптосистемы используют для кодировки сообщений специальный секретный ключ. Такие 
симметричные системы подразделяются на блочные и поточные шифры. Блочные шифры за свою основу берут различные 
перестановки, когда берутся символы текста и переставляются по блокам, и подстановки, когда каждый символ отдельного 
блока заменяется другим символом из того же алфавита. Поточные же шифры работают быстрее, а также для их реализации 
требуются маленькие объемы информации.
Рассмотрим наиболее известный симметричный шифр AES:
С помощью данного алгоритма данные представляются в виде двумерного байтового массива, размер которого – 4*4. После 
этого над отдельными байтами, а также над независимыми столбцами и строками производятся некоторые операции:
1. Операция SubBytes делает табличную замену каждого байта массива данных.
2. Операция ShiftRows осуществляет циклический сдвиг влево всех строк массива данных, кроме нулевой (см. рис. 3). Схема 
сдвига следующая: сдвиг i{\displaystyle i\,\!}-ой строки массива (для i=1,2,3{\displaystyle i = 1, 2, 3 \,\!}) 
производится на i{\displaystyle i\,\!} байт.
3. Операция MixColumns выполняет умножение каждого столбца массива данных (см. рис. 4) на полином a(x), являющийся 
фиксированным {\displaystyle a(x) \,\!}:
a(x)=3x3+x2+x+2{\displaystyle a(x) = 3x^3 + x^2 + x + 2 \,\!}
Умножение выполняется по модулю x4+1{\displaystyle x^4 + 1 \,\!}.
4. Операция AddRoundKey выполняет наложение на массив данных специального ключа, то есть на i{\displaystyle i\,
\!}-ый столбец массива данных (i=0...3){\displaystyle (i = 0...3) \,\!} побитовой логической операцией 
«симметрической разности» (XOR){\displaystyle (XOR) \,\!} накладывается определенное слово расширенного 
ключа W4r+i{\displaystyle W_{4r+i} \,\!}, где r{\displaystyle r\,\!} – номер текущего раунда алгоритма, 
начиная с 1.
Количество раундов алгоритма R{\displaystyle R\,\!} зависит от размера ключа.
Перед первым раундом алгоритма выполняется предварительное наложение материала ключа с помощью операции AddRoundKey, 
которая выполняет наложение на открытый текст первых четырех слов расширенного ключа W0...W3{\displaystyle W_0 ... 
W_3 \,\!}.
Последний же раунд отличается от предыдущих тем, что в нем не выполняется операция MixColumns.
Для расшифрования закодированного сообщения все операции выполняются просто в обратной последовательности
Перед первым раундом расшифрования мы будем выполнять операцию AddRoundKey и накладывать на шифртекст четыре последних 
слов расширенного ключа, т.е. W4R...W4R+3{\displaystyle W_{4R} ... W_{4R+3} \,\!}. После этой операции 
выполняется R{\displaystyle R\,\!} раундов расшифрования:
1. Операция InvShiftRows делает циклический сдвиг вправо трех последних строк массива данных на то же количество байт, 
на которое выполнялся сдвиг операцией ShiftRows при зашифровании.
2. Операция InvSubBytes выполняет обратную табличную замену по байтам
3. Операция AddRoundKey выполняет наложение на обрабатываемые данные четырех слов расширенного ключа W4r...W4r+3
{\displaystyle W_{4r} ... W_{4r+3} \,\!} (как в зашифровании), но раунды r{\displaystyle r\,\!} делаются в 
обратную сторону – от R−1{\displaystyle R-1 \,\!} до 0{\displaystyle 0\,\!}.
4. Операция InvMixColumns выполняет умножение каждого столбца массива на полином a−1(x){\displaystyle a^{-1} (x) \,
\!}, который определяется по формуле:
a−1(x)=Bx3+Dx2+9x+E{\displaystyle a^{-1} (x) = Bx^3 + Dx^2 + 9x + E \,\!}.
Как и в зашифровании, последний раунд расшифрования не будет содержать операцию InvMixColumns.
Плюсы симметричных систем:
- не требуют больших ресурсов вычислительных машин;
- быстрое осуществление шифрования;
- возможность кодировать больших объемов информации;
- математическое простое осуществление шифрования.
Минусы симметричных систем:
- у отправителя должен иметься ключ на каждого получателя сообщения;
- симметричный шифр можно взломать с помощью атаки по ключу.
   
   #### 1.3.4. Симметричные шифры. DES
   
Шифр DES (Data Encryption Standard) - это алгоритм симметричного шифрования данных, блочный шифр, изобретенный в США 
(компания IBM) в 80-х годах ХХ века. Алгоритм основан на сети Фейстеля с 16 циклами (раундами) и 56-битным ключом и 
использует комбинацию нелинейных (S-блоки) и линейных (перестановки E, IP, IP-1) преобразований. Рекомендуемые режимы: 
ECB – режим «электронной кодовой книги» (простая замена); CBC – режим сцепления блоков; CFB – режим обратной связи по 
шифротексту; OFB – режим обратной связи по выходу; Counter Mode (CTR) – режим счётчика.
Раунд принимает Li-1 Ri-1 от предыдущего раунда (или начального блока перестановки) и создает для следующего раунда Li 
и Ri, которые поступают на следующий раунд (или конечный блок перестановки). Можно принять, что каждый раунд имеет два 
элемента шифра (смеситель и устройство замены). Каждый из этих элементов, а также устройство замены, меняющее местами 
левую и правую половины текста, и смеситель (операция «исключающее ИЛИ»), являются обратимыми. Все необратимые элементы 
сосредоточены в функции f (Ri-1, Ki).
Основной блок DES – функция DES, которая с помощью 48-битового ключа зашифровывает 32 самых правых бит Ri-1, чтобы 
получить на выходе 32-битовое слово. DES содержит 4 секции: отбеливатель (whitener), P-блок расширения, группу S-блоков 
и прямой P-блок.
DES все еще используется (например, в алгоритме Triple DES, где применяется 3 раза подряд), несмотря на то, что имеет 
ограничения 56 бит на ключ и 64 бит на данные.
   
   #### 1.3.5. Симметричные шифры. BlowFish
   
Криптографический алгоритм Blowfish реализует блочное симметричное шифрование с переменной длиной ключа, который был 
разработан Брюсом Шнайером в 1993 году.
Алгоритм состоит из двух частей: расширение ключа и шифрование данных, причем исходный ключ из 448 бит разбивается на 
18 32-битовых подключей и в 32-битных S-блока, из 256 элементов.  
Функция в алгоритме принимает на вход блок размером в 32 бита и делит его на четыре 8-битных блока, которые 
складываются по модулю 232  с подключами. Полученные значения «прогоняются» через Сеть Фейстеля из 16 раундов.

   #### 1.3.6. Симметричные шифры. Гаммирование
   
Гаммирование — это еще один метод симметричного шифрования, когда открытый текст накладывается на последовательность, 
которая состоит из совершенно случайных чисел. Данная «гамма-последовательность» участвует как в зашифровывании, так и 
в расшифровывании данных. Поскольку суммирование происходит по модулю 2, то этот шифр называют Шифр XOR.
Если говорить об особенностях гаммы-последовательности, то стоит упомянуть о том, что при шифровании каждого нового 
сообщения генерируется новая гамма. Это можно объяснить тем, что операция XOR обладает некоторыми свойствами. Например, 
если два открытых текста X1 и X2 зашифрованы с помощью одной гаммы Y, то можно сложить получившиеся шифрграммы Z1 и Z2 
по модулю 2 и полученный результат подвергнуть частотному анализу. В итоге мы можем получить наши открытые тексты, не 
подбирая гамму Y.
Обычно создается такая гамма, чтобы ее длина была не меньше длины открытого текста, чтобы избежать анализа блоков 
шифртекста и подбора битов гаммы. Для создания самой последовательности псевдослучайных чисел обычно применяется ГПСЧ 
(генератор псевдослучайных чисел).

   #### 1.3.7. Симметричные шифры. Шифр Вернама
   
Шифр Вернама — система симметричного шифрования, которая была изобретена в 1917 году Гилбертом Вернамом, сотрудником 
телекоммуникационной компанией AT&T. В этом шифре используется булева функция «исключающее или», по-другому называемая 
XORом. Несмотря на то, что шифр Вернама является одной из простейших криптосистем, он обладает абсолютной 
криптографической стойкостью.
Когда сообщение шифруется, то сложение индексов символов происходит по модулю длины алфавита. Стоит отметить, что если 
не знать ключ, то зашифрованное сообщение не поддаётся анализу. Это можно объяснить тем, что случайная 
последовательность накладывается на открытый текст, а результат этого наложения представляет из себя совершенно 
случайный набор символов и букв.
По классике данный алгоритм буде называться шифром Вернама по модулю m, где знаки открытого текста, шифрованного текста 
и ключа принимают значения из кольца вычетов Zm. Так ,например, кодирование шифром Вернама по модулю m = 26 происходит 
в алфавите с 26-тью символами (A=0,B=1,…, Z=25). Шифр является обобщением оригинального шифра Вернама, где применяется 
операция «исключающее или», то есть m = 2.

   #### 1.3.8. Симметричные шифры. ГОСТ 28147-89
   
ГОСТ 28147-89 — симметричный шифр, государственный стандарт СССР, являющимся алгоритмом симметричного блочного 
шифрования. Этот криптоалгоритм представляет собой блочный шифр, использующий 256-битный ключ и 32 цикла (раунда) 
преобразования, в котором производятся операции над 64-битными блоками. Работа шифра основана на сети Фейстеля, но ГОСТ 
28147-89 может работать в режимах простой замены, гаммирования, гаммирования с обратной связью и режиме выработки 
имитовставки.
Например, в режиме простой замены происходит шифрование 64-битного блока открытого текста, который сначала разбивается 
на две половины. Потом 256-битный ключ разбивается на восемь 32-битных подключей, и каждая половина 64-битного блока 
складываются по модулю 232 с подключами.
Результат разбивается на восемь 4-битовых подпоследовательностей, каждая из которых превращается в S-блок, а потом 
опять преобразовывается в 4-ех битную последовательность. Эти «выходы» объединяются в 32-битное слово, которое 
циклически сдвигается влево на 11 битов.

   #### 1.3.9. Асимметричные шифры. RSA
   
Двухключевые (асимметричные) криптосистемы используют два вида ключей, а именно, секретный и открытый ключи. Также их 
называют асимметричными криптосистемами, потому что там используются разные функции для зашифрования и расшифрования 
сообщений. Пример наиболее известной асимметричной криптосистемы – это RSA. Рассмотрим этот метод более детально и 
поймем весь механизм изнутри. Сделаем это с помощью простого примера.
На первом шаге мы занимаемся подготовкой ключей, то есть генерацией публичного и приватного ключа.
Выбираем два любых простых числа. Пусть это будет p=7 и q=13;
произведение наших простых чисел будет нашим модулем: n=p×q=7×13=91;
Вычисляем функцию Эйлера: φ=(p-1)×(q-1)=6×12=72.
Выбираем число e, которое будет отвечать следующим критериям:
(a) оно должно быть простое,
(b) оно должно быть меньше φ — оставляем: 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 39, 41, 43, 47, 53, 57, 59, 61, 67, 71;
(c) оно должно быть взаимно простое с φ => остаются варианты: 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 39, 41, 43, 47, 53, 57, 59, 61, 67, 71;
Выберем e=5. Это, так называемая, открытая экспонента.
Теперь пара чисел {e, n} — это открытый ключ. Его уже смело можно отправлять человеку, который будет зашифровывать 
какое-либо сообщение.
Однако, не все так просто, поэтому нам еще придется вычислить закрытый ключ. Для этого необходимо вычислить число d, 
обратное е по модулю φ. Остаток от деления по модулю φ произведения d×e должен быть равен 1, то 
есть(d×е)%φ=1.Получаем, что d может быть равным 29, поэтому (29×5)%72=145%72=1. Вычислив закрытый ключ, пару {d, n}, 
мы оставляем его у себя, потому что только обладатель ключа способен раскодировать скрытый текст.
На втором шаге мы приступаем к самому шифрованию нашего сообщения - число 7, которое обозначим за P=7. Здесь надо заметить, 
что сообщение P=7 не должно быть больше n=91, иначе шифрование/расшифрование не получится.
Вспомним, что открытый ключ {E, N} = {5,91}, который мы уже вычислили на первом шаге алгоритма.
Шифрование выполняется по следующему алгоритму:
Возводим наше сообщение в степень e по модулю n. То есть, вычисляем 7 в степени 5 (16807) и берём остаток от 
деления на 91. В итоге 63 — это наши закодированные данные.
Полученные данные E=63, мы отправляем получателю с закрытым ключом.
На последнем, третьем шаге мы занимаемся расшифровкой полученных данных (E=63) с помощью закрытого ключа {D, N}={29, 91}.
Отмечу, что открытый ключ, в отличие от закрытого, не может расшифровать сообщение, в этом заключается главная особенность 
асимметричного шифрования. Итак, начинаем расшифровывать кодируемое сообщение: возводим E в степень D, получаем 
63 в степени 29, а потом вычисляем остаток от деления на 91 и получаем 7 — наше сообщение.
Плюсы асимметричных шифров:
    • можно не выделять специальные секретные каналы связи для обмена ключами;
    • взлом шифр приводится к решению очень трудной математической задачи, следовательно, повышается стойкость алгоритма;
    • с помощью ассиметричных систем можно решать другие проблемы, не связанные с шифрованием.
Минусы асимметричных систем:
    • предъявление требований к процессору компьютера: он должен быть производительным для осуществления кодирования;
    • большая ресурсоемкость;
    • асимметричное шифрование математически сложное;
    • медленное кодирование;
    • кодировать можно только малые объемы данных.